{"version":3,"sources":["index.js","karaoke.mid","lyrics-thai.txt","lyrics-romanized.txt","lyrics-english.txt","lyrics-japanese.txt","song.mp3"],"names":["div","style","el","document","createElement","setAttribute","append","child","to","container","appendChild","body","background","textAlign","cont","karaview","white","blueContainer","blue","outline","max","min","color","out","i","j","Math","abs","push","textFont","measurer","englishText","text","textContent","counter","translation","translationContent","blueText","blueTextContent","blueTranslation","blueTranslationContent","element","setText","thai","english","scaleX","offsetWidth","transform","setProgress","progress","width","setOpacity","o","opacity","measure","setEnglish","innerHTML","setCounter","t","createKaraview","rawData","midi","require","lyrics","default","romanization","japanese","songUrl","console","log","trim","split","translations","englishRaw","_","zip","map","en","jp","match","replace","karaokeData","MIDIFile","MIDIEvents","currentPage","start","ticks","pages","getMidiEvents","event","subtype","EVENT_MIDI_NOTE_ON","param1","playTime","EVENT_MIDI_NOTE_OFF","lastTick","invariant","length","zipWith","lyric","page","timing","englishData","slice","leading","a","resolver","values","domains","index","sortedIndex","dx","Δt","use","assert","equal","displayer","currentResolver","currentStart","currentEnd","currentCounter","currentIndex","englishStarts","display","time","join","widths","acText","x","sum","count","beat","updateKaraoke","englishIndex","updateEnglish","audio","controls","src","load","marginTop","requestAnimationFrame","frame","currentTime","module","exports"],"mappings":"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","file":"static/js/main.e4b8ba8f.chunk.js","sourcesContent":["/* eslint import/no-webpack-loader-syntax: off */\n\nimport _ from 'lodash'\nimport assert from 'assert'\nimport invariant from 'invariant'\n\ndocument.body.style.background = '#000'\ndocument.body.style.textAlign = 'center'\n\nfunction div (style) {\n  const el = document.createElement('div')\n  el.setAttribute('style', style)\n  return el\n}\n\nfunction append (child) {\n  return { to (container) {\n    container.appendChild(child)\n    return child\n  } }\n}\n\nfunction createKaraview () {\n  const container = div(`white-space:nowrap;`)\n  const white = append(div(``)).to(container)\n  const blueContainer = append(div(`\n    position: absolute;\n    top: 0; left: 0; width: 540px; height: 540px;\n    overflow: hidden;\n  `)).to(container)\n  const blue = append(div(`\n    position: absolute;\n    top: 0; left: 0; width: 960px; height: 540px;\n  `)).to(blueContainer)\n\n\n  function outline (max, min, color) {\n    const out = [ ]\n    for (let i = -max; i <= max; i += 0.5) {\n      for (let j = -max; j <= max; j += 0.5) {\n        if (Math.abs(i) < min && Math.abs(j) < min) continue\n        out.push(`${i}px ${j}px 0 ${color}`)\n      }\n    }\n    return out\n  }\n\n  const textFont = 'bold 59px kinnari,aozora mincho,serif'\n  const measurer = append(div(`\n    position: absolute;\n    left: 0;\n    top: 0;\n    font: ${textFont};\n    white-space: pre;\n    color: transparent;\n  `)).to(container)\n  const englishText = append(div(`\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    top: 15px;\n    font: 24px 'Avenir Next Condensed',sans-serif;\n    font-weight: 500;\n    color: white;\n    text-shadow: 0 1px 3px black;\n    text-align: center;\n    -webkit-font-smoothing: antialiased;\n  `)).to(container)\n  const text = append(div(`\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    top: 366px;\n    font: ${textFont};\n    white-space: pre;\n    color: transparent;\n  `)).to(white)\n  const textContent = append(div(`\n    position: relative;\n    color: white;\n    text-shadow:\n      ${outline(2,0.5,'black')};\n  `)).to(text)\n  const counter = append(div(`\n    position: absolute;\n    top: 0.2em;\n    left: -1.25em;\n    color: white;\n    font-family: serif;\n    text-shadow:\n      ${outline(2,0.5,'black')};\n  `)).to(text)\n  counter.textContent = ''\n\n  const translation = append(div(`\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    top: 462px;\n    font: 30px Futura,sans-serif;\n    color: transparent;\n  `)).to(white)\n  const translationContent = append(div(`\n    position: relative;\n    color: #DD7700;\n    text-shadow:\n      ${outline(2,0.5,'black')};\n  `)).to(translation)\n\n  const blueText = append(div(`\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    top: 366px;\n    font: ${textFont};\n    white-space: pre;\n    color: transparent;\n  `)).to(blue)\n  const blueTextContent = append(div(`\n    position: relative;\n    color: #353433;\n    text-shadow:\n      ${outline(1.5,0.5,'white')},\n      ${outline(3,1.5,'black')};\n  `)).to(blueText)\n\n  const blueTranslation = append(div(`\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    top: 462px;\n    font: 30px Futura,sans-serif;\n    color: transparent;\n  `)).to(blue)\n  const blueTranslationContent = append(div(`\n    position: relative;\n    color: #353433;\n    text-shadow:\n      ${outline(1.5,0.5,'white')},\n      ${outline(3,1.5,'black')};\n  `)).to(blueTranslation)\n\n  function setText (thai, english) {\n    textContent.textContent = thai\n    blueTextContent.textContent = thai\n    translationContent.textContent = english\n    blueTranslationContent.textContent = english\n    const scaleX = Math.min(1, textContent.offsetWidth / translationContent.offsetWidth)\n    translationContent.style.transform = `scaleX(${scaleX})`\n    blueTranslationContent.style.transform = `scaleX(${scaleX})`\n  }\n\n  function setEnglish (text) {\n    englishText.innerHTML = text\n  }\n\n  function setProgress (progress) {\n    blueContainer.style.width = Math.min(960, Math.max(0, progress * 960)) + 'px'\n  }\n\n  function measure (text) {\n    measurer.textContent = text\n    return measurer.offsetWidth\n  }\n\n  function setOpacity (o) {\n    container.style.opacity = o\n  }\n\n  function setCounter (t) {\n    counter.textContent = t\n  }\n\n  return { element: container, setText, setProgress, setOpacity, measure, setEnglish, setCounter }\n}\n\nconst cont = div(`\n  background: #0f0;\n  width: 960px;\n  height: 540px;\n  position: relative;\n  display: inline-block;\n  overflow: hidden;\n  text-align: left;\n`)\n\nconst karaview = createKaraview()\nappend(karaview.element).to(cont)\nappend(cont).to(document.body)\n\n/*\nkaraview.setText('เพราะวันเวลาที่ผ่านมา', 'PRAW-WAN-VE-LA-TEE-PAAN-MA')\nwindow.onmousemove = function (e) {\n  karaview.setProgress((e.pageX - cont.offsetLeft) / 640)\n}\n*/\n\nconst rawData = {\n  midi: require('!!arraybuffer-loader!./karaoke.mid'),\n  lyrics: require('!!raw-loader!./lyrics-thai.txt').default,\n  romanization: require('!!raw-loader!./lyrics-romanized.txt').default,\n  english: require('!!raw-loader!./lyrics-english.txt').default,\n  japanese: require('!!raw-loader!./lyrics-japanese.txt').default,\n  songUrl: require('!!file-loader!./song.mp3').default\n}\nconsole.log(rawData)\nconst lyrics = rawData.lyrics.trim().split('\\n')\nconst translations = rawData.romanization.trim().split('\\n')\n\nconst w = (text) => !text ? '' : `<span style=\"display:inline-block;background:rgba(0,0,0,0.5);padding:0 8px 2px;border-radius:4px;\">${text}</span>`\nconst englishRaw = (() => {\n  if (!rawData.english) return [ ]\n  return _.zip(\n    rawData.english.trim().split('\\n'),\n    rawData.japanese.trim().split('\\n')\n  ).map(([ en, jp ]) => `${(en.match(/^\\/+/) || [''])[0]}${\n    en+jp\n    ? w(`<div style=\"font-family:osaka,sans-serif;font-weight:300;\">${jp}</div><div style=\"${jp?'font-size:72%':''};\">${en.replace(/^\\/*/, '')}</div>`)\n    :''}`)\n})()\n\nconst karaokeData = (() => {\n  const MIDIFile = require('midifile')\n  const MIDIEvents = require('midievents')\n  const midi = new MIDIFile(rawData.midi)\n  let currentPage = { start: 0, ticks: [ ] }\n  const pages = [ currentPage ]\n  for (const event of midi.getMidiEvents()) {\n    if (event.subtype === MIDIEvents.EVENT_MIDI_NOTE_ON) {\n      if (event.param1 === 59) {\n        currentPage.ticks.push(event.playTime)\n      }\n      if (event.param1 === 50) {\n        currentPage = { start: event.playTime, ticks: [ ] }\n        pages.push(currentPage)\n      }\n    }\n    if (event.subtype === MIDIEvents.EVENT_MIDI_NOTE_OFF) {\n      if (event.param1 === 59) {\n        currentPage.lastTick = event.playTime\n      }\n    }\n  }\n  invariant(pages.length === lyrics.length, 'Expected %d lines === %d pages', lyrics.length, pages.length)\n  return _.zipWith(lyrics, pages, translations, (lyric, page, translation) => {\n    const split = lyric.split('|')\n    const ticks = [ ...page.ticks, page.lastTick ]\n    invariant(split.length + 1 === ticks.length, 'Expected %s to have %s ticks', lyric, ticks.length)\n    return { start: page.start, timing: ticks, lyrics: split, translation }\n  })\n})()\n\nconst englishData = _.zipWith(karaokeData.slice(0, englishRaw.length), englishRaw, (page, text) => {\n  let leading = 0\n  text = text.replace(/^\\/+/, (a) => {\n    leading = a.length * (60000 / 240)\n    return ''\n  })\n  return { start: page.start - leading, text }\n})\n\nfunction resolver (values) {\n  const domains = _.map(values, 0)\n  return (t) => {\n    const index = _.sortedIndex(domains, t) - 1\n    if (index === -1) {\n      const dx = (values[1][1] - values[0][1]) / (values[1][0] - values[0][0])\n      const Δt = t - values[0][0]\n      return values[0][1] + Δt * dx\n    }\n    const use = Math.min(index, values.length - 2)\n    const dx = (values[use + 1][1] - values[use][1]) / (values[use + 1][0] - values[use][0])\n    const Δt = t - values[index][0]\n    return values[index][1] + Δt * dx\n  }\n}\n\nassert.equal(resolver([ [ 5000, 50 ], [ 5100, 60 ] ])(4900), 40)\nassert.equal(resolver([ [ 5000, 50 ], [ 5100, 60 ] ])(5000), 50)\nassert.equal(resolver([ [ 5000, 50 ], [ 5100, 60 ] ])(5100), 60)\nassert.equal(resolver([ [ 5000, 50 ], [ 5100, 60 ] ])(5200), 70)\n\nconst displayer = (() => {\n  let currentIndex = -1\n  let currentResolver\n  let currentPage\n  let currentStart, currentEnd\n  let currentCounter\n\n  let currentEnglishIndex = -1\n  const englishStarts = _.map(englishData, 'start')\n\n  function display (time) {\n    updateKaraoke()\n    updateEnglish()\n\n    function updateKaraoke () {\n      const index = (() => {\n        for (let i = 0; i < karaokeData.length; i ++) {\n          if (time >= karaokeData[i].start) {\n            if (i + 1 >= karaokeData.length || time < karaokeData[i + 1].start) {\n              return i\n            }\n          }\n        }\n        return 0\n      })()\n      if (currentIndex !== index) {\n        currentIndex = index\n        const page = karaokeData[index]\n        karaview.setText(page.lyrics.join(''), page.translation)\n        const width = karaview.measure(page.lyrics.join(''))\n        const widths = [ 0 ]\n        let acText = ''\n        for (let i = 0; i < page.lyrics.length; i ++) {\n          acText += page.lyrics[i]\n          widths.push(karaview.measure(acText))\n        }\n        const map = [ ]\n        for (let i = 0; i < page.timing.length; i ++) {\n          const x = (480 - width / 2 + widths[i]) / 960\n          map.push([ page.timing[i], x ])\n        }\n        currentPage = page\n        currentResolver = resolver(map)\n        currentStart = page.timing[0]\n        currentEnd = page.timing[page.timing.length - 1]\n      }\n      if (currentResolver) {\n        let sum = 0, count = 0\n        for (let i = -5; i <= 10; i ++) {\n          sum += currentResolver(time + i * 50)\n          count += 1\n        }\n        karaview.setProgress(sum / count)\n        karaview.setOpacity(\n          Math.max(0, Math.min(1,\n            Math.min(\n              (time - currentStart) / 2000 + 2,\n              (currentEnd - time) / 2000 + 2\n            )\n          ))\n        )\n        const beat = 60000 / 238\n        const counter = (currentStart - currentPage.start > 4000\n          ? (() => {\n            if (time + 0 >= currentStart) return ''\n            if (time + 0 >= currentStart - 1 * beat) return '' // '④③②①''\n            if (time + 0 >= currentStart - 2 * beat) return '①' // '④③②①''\n            if (time + 0 >= currentStart - 3 * beat) return '②' // '④③②①''\n            if (time + 0 >= currentStart - 4 * beat) return '③' // '④③②①''\n            return ''\n          })()\n          : ''\n        )\n        if (counter !== currentCounter) {\n          currentCounter = counter\n          karaview.setCounter(currentCounter)\n        }\n      }\n    }\n\n    function updateEnglish () {\n      const englishIndex = _.sortedIndex(englishStarts, time) - 1\n      if (currentEnglishIndex !== englishIndex) {\n        karaview.setEnglish(englishData[englishIndex].text)\n      }\n    }\n  }\n\n  return { display }\n})()\n\nconst audio = document.createElement('audio')\naudio.controls = true\naudio.src = rawData.songUrl\naudio.load()\naudio.style.marginTop = '16px'\naudio.style.width = '960px'\ndocument.body.appendChild(audio)\n\nfunction frame () {\n  displayer.display(audio.currentTime * 1000)\n  requestAnimationFrame(frame)\n}\n\nrequestAnimationFrame(frame)\n","module.exports = require(\"../node_modules/arraybuffer-loader/lib/to-array-buffer.js\")(\"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\")","export default \"ฉัน |ฉัน|นั้น|โชค|ดี|เหลือ|เกิน\\nที่|ได้|เกิด|มา|ได้|พบ|เจอ|กับ|เธอ\\nทำ|ให้|เรา|ได้|รัก|กัน\\nมี|วัน|เว|ลา|ที่|สวย|งาม\\nเพราะ|เธอ |เพราะ|เธอ\\nคิด |ฉัน|คิด|ถึง|เธอ|เหลือ|เกิน\\nอยาก|ให้|เธอ|มา|อยู่|ตรง|นี้|ข้าง|กาย\\nแม้|วัน|เว|ลา|ที่|ผ่าน|มา\\nทำ|ให้|เธอ|นั้น|หาย|ไป\\nแต่|ใน|ใจ|ของ|ฉัน|ไม่|เคย|จะ|ลืม\\nเวียน|เปลี่ยน|หมุน|ไป\\nวัน|เว|ลา|ไม่|เคย|จะ|รอ|ใคร|ใคร|ทั้ง|นั้น\\nห่าง|กัน|แค่|ไหน\\nใจ|ฉัน|ยัง|รอ\\nแค่|เพียง|อยาก|บอก|ว่า\\nรัก|เธอ|ทุก|วัน\\nรัก|เธอ|เหลือ|เกิน\\nอยาก|ให้|เธอ|อยู่|ตรง|นี้|นาน|นาน\\nและ|ยัง|คง|รัก|เธอ|ทุก|วัน\\nคิด|ถึง|เธอ|ทุก|คืน\\nอยาก|ให้|เธอ|ได้|ยิน\\nว่า|ฉัน|รัก|เธอ |จริง|จริง\\nอยาก|บอก|ว่า\\nรัก|เธอ |รัก|เธอ\\nรัก|เธอ |รัก|เธอ\\nแต่|ว่า|ทำ|ได้|เพียง\\nคิด|ถึง|เธอ|คน|เดียว\\n\";","export default \"CHAN-CHAN-NUN-CHOK-DEE-LEUR-GURN\\nTEE-DAI-GERD-MA-DAI-PHOB-JER-GUB-TUR\\nTUM-HAI-ROW-DAI-RUK-GUN\\nME-WAN-VE-LA-TEE-SUAY-NGAM\\nPRAW-TUR-PRAW-TUR\\nKID-CHAN-KID-TUENG-TUR-LUER-GURN\\nYAHK-HAI-TUR-MAA-YOU-TRONG-NI-KANG-GAI\\nMAE-WAN-VE-LA-TEE-PAAN-MA\\nTUM-HAI-TER-NAN-HAI-PAI\\nTAE-NAI-JAI-KORNG-CHAN-MAI-KOEI-JA-LUEM\\nWIAN-PLIAN-MOON-PAI\\nWAN-VE-LA-MAI-KOEI-JA-RAW-KRAI-KRAI-TAANG-NAAN\\nHAANG-GUN-KAE-NAI\\nJAI-CHAN-YANG-RAW\\nKAE-PIANG-YAHK-BAUK-WAH\\nRUK-TUR-TOOK-WAN\\nRUK-TUR-LUER-GERN\\nYAHK-HAI-TUR-YOO-TRONG-NEE-NAAN-NAAN\\nLAE-YOUNG-KONG-RUK-TUR-TOOK-WAN\\nKID-TUENG-TUR-TOOK-KEUN\\nYAHK-HAI-TUR-DAI-YIN\\nWAH-CHAN-RUK-TUR-JING-JING\\nYAHK-BAUK-WAH\\nRUK-TUR-RUK-TUR\\nRUK-TUR-RUK-TUR\\nTAE-WAH-TUM-DAI-PIANG\\nKID-TUENG-TUR-KON-DIAW\\n\";","export default \"How—how fortunate I am\\nThat I have found you here in my life\\nLove that we have cared and\\nAll good times that we shared\\n//All because of you, because of you\\nMiss—I miss you all this time\\nI just wish that you were by my side\\n’cause what we have been through\\n/Separated you away\\nBut in my heart all these moments stay\\nRevolvin’ around, spinnin’ around\\nTime is never gonna wait for anyone\\nDespite how far\\nI’ll wait for you\\nAnd I will say I\\nLove you everyday\\nLove you evermore\\nWish you’re stayin’ with me here, always\\n’cause I still love you everyday\\nAnd miss you every night\\nWish you’d know I love\\nyou ’til the end of time\\nWanna say I\\nLove you, Love you\\nLove you, Love you\\nBut now I only can\\nDream of you alone\\n\";","export default \"ああ 幸せなのは\\nあなたに出逢えたこと\\n共に育んだ愛\\n共に過ごした時\\nあなたがいたから\\nああ ずっと恋しいの\\n「側にいて」願うだけ\\nちょっとしたことが\\n二人を離した\\nまだ忘れられなくて\\nただただ\\n時は回ってゆくだけ\\n遠く 遠く\\nあなたを\\n待ち続ける\\n\\n\\nいつも側にいてよ\\n\\n\\nずっとずっと\\nあなたが好き\\n伝えたい\\n\\n\\nでも今は\\nひとりの夢\\n\";","export default __webpack_public_path__ + \"b54cbef55887099580c1e42d4dade214.mp3\";"],"sourceRoot":""}